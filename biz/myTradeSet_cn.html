<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->

<!-- BEGIN HEAD -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="import" href="/templates/biz/commCss.html">
    <title>我的资产</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <style>
        .page-header {
            opacity: 1;
            filter: alpha(opacity=100);
            width: 100%;
            margin: 0;
            border: 0;
            padding: 0;
            height: 51px;
            background-image: none;
        }
    </style>
</head>

<!-- END HEAD -->

<body class="page-container-bg-solid">
    <div class="page-wrapper">
        <div class="page-wrapper-row">
            <div class="page-wrapper-top">
                <!--menu上面LOGO与使用者信息 start-->
                <div class="page-header">
                    <!--menu上面LOGO与使用者信息 end-->
                    <!--menu构成(黑色条) start-->
                    <div class="page-header-menu">
                        <div class="container">
                            <div class="hor-menu  ">
                                <table>
                                    <tr>
                                        <td width="300px">&nbsp;</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="hor-menu  ">
                                <ul class="nav navbar-nav">
                                    <li class="menu-dropdown classic-menu-dropdown ">
                                        <a href="/templates/biz/main_cn.html"> 交易 <span class="arrow"></span></a>
                                    </li>
                                    <li class="menu-dropdown mega-menu-dropdown ">
                                        <a href="/templates/biz/myPosition_cn.html"> 持仓信息 <span class="arrow"></span></a>
                                    </li>
                                    <li class="menu-dropdown mega-menu-dropdown active">
                                        <a href="/templates/biz/myAsset_cn.html"> 我的资产 <span class="arrow "></span></a>
                                    </li>
                                </ul>
                            </div>
                            <div class="hor-menu pull-right">
                                <ul class="nav navbar-nav pull-right">
                                    <li class="dropdown dropdown-user">
                                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                            <i class="icon-user"></i>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-default">
                                            <li>
                                                <a href="/templates/biz/myBasicSet_cn.html">
                                                    <i class="icon-user"></i> Basic Info </a>
                                            </li>
                                            <li>
                                                <a href="/templates/biz/myBankSet_cn.html">
                                                    <i class="fa fa-bank"></i> Bank Info </a>
                                            </li>
                                            <li>
                                                <a href="/templates/biz/myLoginInfo_cn.html">
                                                    <i class="fa fa-info-circle"></i> Login Info
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/templates/biz/myVipInfo.html">
                                                    <i class="fa fa-vimeo"></i> VIP Info
                                                    <span class="badge badge-danger"> 1 </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="/templates/biz/eventInfo.html">
                                                    <i class="fa fa-birthday-cake"></i>Event Info
                                                    <span class="badge badge-danger"> 3 </span>
                                                </a>
                                            </li>
                                            <li class="divider"> </li>
                                            <li>
                                                <a href="#" onclick="javascript:Comm.logOut();">
                                                    <i class="icon-key"></i>Log Out </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="dropdown dropdown-user">
                                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                            <i class="icon-settings"></i>
                                        </a>
                                        <ul class="dropdown-menu dropdown-menu-default">
                                            <li>
                                                <a href="/templates/biz/myTradeSet_cn.html">
                                                    <i class="fa fa-dollar"></i> Trade Setting </a>
                                            </li>
                                        </ul>
                                    </li>
                                    <!-- END USER LOGIN DROPDOWN -->
                                </ul>

                            </div>
                            <!-- END MEGA MENU -->
                        </div>
                    </div>
                    <!--menu构成(黑色条) end-->
                </div>
            </div>

        </div>
        <div class="page-wrapper-row full-height">
            <div class="page-wrapper-middle">
                <!-- BEGIN CONTAINER -->
                <div class="page-container">
                    <!-- BEGIN CONTENT -->
                    <div class="page-content-wrapper">
                        <!-- BEGIN CONTENT BODY -->
                        <!-- BEGIN PAGE CONTENT BODY -->
                        <div class="page-content">
                            <div class="container">
                                <!-- BEGIN PAGE CONTENT INNER -->
                                <div class="page-content-inner">
                                    <div class="mt-content-body">
                                        <div class="row">
                                            <div class="col-md-8" style="position:absolute;left:16.666667%;">
                                                <!-- BEGIN PORTLET-->
                                                <div class="portlet light form-fit bordered center">
                                                    <div class="portlet-title">
                                                        <div class="caption">
                                                            <i class="icon-social-dribbble font-green"></i>
                                                            <span class="caption-subject font-green bold uppercase">Trade Setting</span>
                                                        </div>
                                                        <div align="right">
                                                            <input type="checkbox" class="make-switch" name="formEdit" id="formEdit" data-on-color="success" data-off-color="danger" data-on-text="Edit" data-off-text="ReadOnly">
                                                            <button type="button" class="btn blue" id="saveBtn">Save</button>
                                                        </div>
                                                    </div>
                                                    <div class="portlet-body form">
                                                        <!-- BEGIN FORM-->
                                                        <form id='dataForm' action="#" class="form-horizontal form-bordered">
                                                            <div class="form-body">
                                                                <div class="form-group">
                                                                    <label class="control-label col-md-3">OverNight</label>
                                                                    <div class="col-md-4">
                                                                        <input type="checkbox" class="make-switch" checked name="OverNight" data-key="OverNight" data-type="SWITCH" data-on-color="success" data-off-color="danger">

                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="control-label col-md-3">ProfitInvestActive</label>
                                                                    <div class="col-md-4">
                                                                        <input type="checkbox" class="make-switch" checked name="ProfitInvestActive" data-key="ProfitInvestActive" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="control-label col-md-3">LossCutPcnt(%)</label>
                                                                    <div class="col-md-4">
                                                                        <input class="form-control" id="LossCutPcnt" type="text" maxlength='5' data-key="LossCutPcnt" data-type="PERCENT" data-inputmask="'alias':'leftPercent'" />

                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="control-label col-md-3">CloseOrderOfShortPosition</label>
                                                                    <div class="col-md-4">
                                                                        <select class="form-control" id="CloseOrderOfShortPosition" name="CloseOrderOfShortPosition" data-key="CloseOrderOfShortPosition" data-type="SELECT">
                                                                            <!-- <option value="">--선택--</option> -->
                                                                            <!-- <option value="0001">선입선출 방식</option>
                                                                            <option value="0002">후입선출 방식</option>
                                                                            <option value="0003">마진우선 방식</option>
                                                                            <option value="0004">평균가 반환</option>
                                                                            <option value="0005">Close Order가</option> -->
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="control-label col-md-3">ClosePositonOfOverNight</label>
                                                                    <div class="col-md-4">
                                                                        <select class="form-control" id="ClosePositonOfOverNight" name="ClosePositonOfOverNight" data-key="ClosePositonOfOverNight" data-type="SELECT">
                                                                            <!-- <option value="">--선택--</option> -->
                                                                            <!-- <option value="0001">선입선출 방식</option> -->
                                                                            <!-- <option value="0002">후입선출 방식</option> -->
                                                                            <!-- <option value="0003">마진우선 방식</option>
                                                                            <option value="0004">손실우선 방식</option> -->
                                                                        </select>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </form>
                                                        <!-- END FORM-->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- END PAGE CONTENT INNER -->
                        </div>
                    </div>
                    <!-- END PAGE CONTENT BODY -->
                    <!-- END CONTENT BODY -->
                </div>
                <!-- END CONTENT -->
            </div>
            <!-- END CONTAINER -->
        </div>
    </div>
    <div class="page-wrapper-row">
        <div class="page-wrapper-bottom">
            <!-- BEGIN FOOTER -->
            <!-- BEGIN PRE-FOOTER -->
            <div class="page-prefooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 col-xs-12 footer-block">
                            <h2>About</h2>
                            <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam dolore.</p>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs12 footer-block">
                            <h2>Subscribe Email</h2>
                            <div class="subscribe-form">
                                <form action="javascript:;">
                                    <div class="input-group">
                                        <input type="text" placeholder="mail@email.com" class="form-control"> <span class="input-group-btn">
													<button class="btn" type="submit">Submit</button>
												</span>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 footer-block">
                            <h2>Follow Us On</h2>
                            <ul class="social-icons">
                                <li>
                                    <a href="javascript:;" data-original-title="rss" class="rss"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="facebook" class="facebook"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="twitter" class="twitter"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="googleplus" class="googleplus"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="linkedin" class="linkedin"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="youtube" class="youtube"></a>
                                </li>
                                <li>
                                    <a href="javascript:;" data-original-title="vimeo" class="vimeo"></a>
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-3 col-sm-6 col-xs-12 footer-block">
                            <h2>Contacts</h2>
                            <address class="margin-bottom-40">
										Phone: 000-0000-0000 <br> Email: <a
											href="mailto:126@126.com">126@126.com</a>
									</address>
                        </div>
                    </div>
                </div>
            </div>
            <!-- END PRE-FOOTER -->
            <!-- BEGIN INNER FOOTER -->
            <div class="page-footer">
                <div class="container">

                </div>
            </div>
            <div class="scroll-to-top">
                <i class="icon-arrow-up"></i>
            </div>
            <!-- END INNER FOOTER -->
            <!-- END FOOTER -->
        </div>
    </div>
    </div>


</body>
<link rel="import" href="/templates/biz/commJs.html">


<script type="text/javascript">
    $(function() {

        Comm.init();
        getSelectData();
        getBizData();

        readonly();

        $("#formEdit").on('switchChange.bootstrapSwitch', function(event, state) {
            //这个state就是选择的状态
            if (state) {
                editable();
            } else {
                readonly();
            }
        });

        $("#saveBtn").on('click', function() {
            saveData();
        });
    });

    function getSelectData() {
        var settings = {
            "async": false,
            "crossDomain": true,
            "url": Comm.getApiUrl() + "/api/Code/GetCodeInfoByGroups?groudIds=0023,0025",
            "method": "GET",
            "headers": Comm.getHeader()
        }

        $.ajax(settings).done(function(response) {
            console.log(response);
            if (response.Result == 0) {
                var datas = response.Data;
                $.each(datas, function(index, data) {
                    if (data.GroupId == '0023') {
                        initSelect("CloseOrderOfShortPosition", data.Codeinfos);
                    }
                    if (data.GroupId == '0025') {
                        initSelect("ClosePositonOfOverNight", data.Codeinfos);
                    }
                });
            }
        });
    }

    function initSelect(elementNm, codeList) {
        var optionsHtml = "";
        $.each(codeList, function(index, item) {
            optionsHtml += '<option value="' + item.CODEID + '">' + item.CODEKR + '</option>';
        });
        var element = $(("#" + elementNm));
        element.empty();
        element.append(optionsHtml);
    }

    function getBizData() {
        var header = Comm.getHeader();
        var settings = {
            "async": false,
            "crossDomain": true,
            "url": Comm.getApiUrl() + "/api/User/GetUserTradeSetting?userId=" + header.user,
            "method": "GET",
            "headers": Comm.getHeader()
        }

        $.ajax(settings).done(function(response) {
            console.log(response);
            if (response.Result == 0) {
                var datas = response.Data;
                setDomData($("#dataForm"), datas);
            }
        });
    }

    function saveData() {


        var header = Comm.getPostHeader();
        var datas = getDomData($("#dataForm"), header);

        console.log(JSON.stringify(datas));
        console.log(Comm.getHeader());
        var settings = {
            "async": false,
            "crossDomain": true,
            "url": Comm.getApiUrl() + "/api/User/UpUserTradeSetting",
            "method": "POST",
            "headers": Comm.getPostHeader(),
            "data": JSON.stringify(datas)
        }
        $.ajax(settings).done(function(response) {
            // console.log(response);
            if (response.Result == 0) {
                Comm.alert('데이터 변경 성공하였습니다.', 'success');
            } else {
                Comm.alert(response.errorMsg, 'error');
                console.log(response.errorMsg);
            }
            getBizData();
            readonly();
            $("#formEdit").bootstrapSwitch("state", false);
        });
    }


    function editable() {
        $("input[type='text']").each(function(i, ipt) {
            $(ipt).attr("readonly", false);
        });
        $(".make-switch").each(function() {
            if (this.id != "formEdit") {
                $(this).bootstrapSwitch("readonly", false);
            }
        });
        $("select").each(function(i, ipt) {
            $(ipt).attr("disabled", false);
        });
    }

    function readonly() {
        $("#VipForm").find("input").attr("readonly", true);


        $("input[type='text']").each(function(i, ipt) {
            $(ipt).attr("readonly", true);
        });
        $("select").each(function(i, ipt) {
            $(ipt).attr("disabled", true);
        });

        $(".make-switch").each(function() {
            if (this.id != "formEdit") {
                $(this).bootstrapSwitch("readonly", true);
            }
        });
    }

    var getDomData = function($DOM, header) {
        var params = [];
        var domItems = $DOM.find("[data-key]");
        domItems.each(function(index, item) {
            item = $(item);
            var itemNm = item.attr("data-key");
            var itemType = item.attr("data-type");
            var itemValue;
            switch (itemType) {
                case "SWITCH":
                    itemValue = item.bootstrapSwitch("state");
                    if (itemValue) {
                        itemValue = 'Y';
                    } else {
                        itemValue = 'N';
                    }
                    break;
                case "TEXT":
                    itemValue = item.val();
                    if (itemValue == null) {
                        itemValue = "";
                    }
                    break;
                case "MONEY":
                    itemValue = Inputmask.unmask(item.val(), {
                        alias: "currency"
                    });
                    if (itemValue == null) {
                        itemValue = 0;
                    }
                    break;
                case "SELECT":
                    itemValue = item.val();
                    break;
                case "INTEGER":
                    itemValue = item.val();
                    if (itemValue == null || itemValue == "") {
                        itemValue = 0;
                    }
                    break;
                case "PERCENT":
                    itemValue = Inputmask.unmask(item.val(), {
                        alias: "leftPercent"
                    });
                    console.log("percent=" + itemValue);
                    if (itemValue == null) {
                        itemValue = 0;
                    }
                    break;
            }
            var param = {}
            param.USERID = header.user;
            param.CONFIGNAME = itemNm;
            param.CONFIGVALUE = itemValue;
            params.push(param);

        });
        return params;

    }

    var setDomData = function($DOM, params) {

        $.each(params, function(index, param) {
            var datakey = param.CONFIGNAME;
            var dataValue = param.CONFIGVALUE;

            var item = $("[data-key='" + datakey + "']");
            item = $(item);
            var itemType = item.attr("data-type");
            switch (itemType) {
                case "SWITCH":
                    if (dataValue == "Y") {
                        item.bootstrapSwitch("state", true);
                    }

                    if (dataValue == "N") {
                        item.bootstrapSwitch("state", false);
                    }
                    break;
                case "TEXT":
                    item.val(dataValue);
                    break;
                case "MONEY":
                    dataValue = Inputmask.format(dataValue, {
                        alias: "currency_normal"
                    });
                    item.val(dataValue);
                    break;
                case "SELECT":
                    // console.log('setdata_select_value=' + itemValue);
                    item.val(dataValue);
                    // console.log('setdata_select_value after=' + item.val());
                    break;
                case "INTEGER":
                    item.val(dataValue);
                    break;
                case "PERCENT":
                    dataValue = Inputmask.format(dataValue, {
                        alias: "leftPercent"
                    });
                    item.val(dataValue);
                    break;
            }
        })

    }
</script>
<style>
    .th-inner {
        color: white;
        background-color: #525e64;
    }
</style>

</html>