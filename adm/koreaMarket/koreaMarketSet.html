<!DOCTYPE html>
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="import" href="/templates/adm/commCss.html">
    <title>首页</title>
    <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
    <div class="page-wrapper">
        <!-- BEGIN HEADER -->
        <div class="page-header navbar navbar-fixed-top">
            <!-- BEGIN HEADER INNER -->
            <div class="page-header-inner ">
                <!-- BEGIN LOGO -->
                <div class="page-logo">
                    <a href="/templates/adm/index.html">
                        <img src="" alt="logo" class="logo-default" /> </a>
                    <div class="menu-toggler sidebar-toggler">
                        <span></span>
                    </div>
                </div>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
                    <span></span>
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <div class="top-menu">
                    <ul class="nav navbar-nav pull-right">
                        <!-- END USER LOGIN DROPDOWN -->
                        <!-- BEGIN QUICK SIDEBAR TOGGLER -->
                        <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                        <li>
                            <p style="color: white">Welcome Loginer</p>
                        </li>
                        <li class="dropdown dropdown-quick-sidebar-toggler">
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-logout"></i>
                            </a>
                        </li>
                        <!-- END QUICK SIDEBAR TOGGLER -->
                    </ul>
                </div>
                <!-- END TOP NAVIGATION MENU -->
            </div>
            <!-- END HEADER INNER -->
        </div>
        <!-- END HEADER -->
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN SIDEBAR -->
            <div class="page-sidebar-wrapper">
                <div class="page-sidebar navbar-collapse collapse">
                    <ul id="ul_menu" class="page-sidebar-menu  page-header-fixed " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200" style="padding-top: 20px">


                    </ul>
                </div>
            </div>
            <!-- END SIDEBAR -->

            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE TITLE-->
                    <h1 class="page-title"> 한국주식세팅관리
                        <!-- <small>对四种普通VIP信息修改</small> -->
                    </h1>
                    <!-- END PAGE TITLE-->
                    <!-- END PAGE HEADER-->
                    <!-- BEGIN DASHBOARD STATS 1-->
                    <div class="clearfix"></div>
                    <!-- END DASHBOARD STATS 1-->
                    <div class="row">
                        <div class="col-md-8">
                            <div class="portlet light">
                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="fa fa-shopping-cart"></i>주식설정정보</div>
                                    <div align="right">
                                        <input type="checkbox" class="make-switch" name="formEdit" id="formEdit" data-on-color="success" data-off-color="danger" data-on-text="Edit" data-off-text="ReadOnly">
                                        <button type="button" class="btn blue" id="saveBtn">Save</button>
                                    </div>
                                    <!-- <div class="tools">
                                            <a href="javascript:;" class="collapse" data-original-title="" title=""> </a>
                                            <a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title=""> </a>
                                            <a href="javascript:;" class="reload" data-original-title="" title=""> </a>
                                            <a href="javascript:;" class="remove" data-original-title="" title=""> </a>
                                        </div> -->
                                </div>
                                <div class="portlet-body">
                                    <div class="table-scrollable  form-group form-md-line-input">
                                        <form id="settingForm">
                                            <table class="table table-striped table-bordered table-advance">
                                                <thead>
                                                    <tr>
                                                        <th> 설정항목 </th>
                                                        <th> 세팅값 </th>
                                                        <th> 사용여부 </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            코스피 대출 배수
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="MarketMinBrrwRate" data-key2="VALUE1" data-type="INTEGER" data-inputmask="'alias':'leftInteger'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="MarketMinBrrwRate" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 전일 상한가초과
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="OverHLimitRef" data-key2="VALUE1" data-type="PERCENT" data-inputmask="'alias':'leftPercent'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="OverHLimitRef" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 전일 기준가이하
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="OverLLimitRef" data-key2="VALUE1" data-type="PERCENT" data-inputmask="'alias':'leftPercent'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="OverLLimitRef" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td>
                                                            한국주식 당일 상한가초과
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="OverHLimitCur" data-key2="VALUE1" data-type="PERCENT" data-inputmask="'alias':'leftPercent'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="OverHLimitCur" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 당일 기준가이하
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="OverLLimitCur" data-key2="VALUE1" data-type="PERCENT" data-inputmask="'alias':'leftPercent'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="OverLLimitCur" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 전일 거래랑 미달
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="AmtLowerRef" data-key2="VALUE1" data-type="MONEY" data-inputmask="'alias':'currency_normal'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="AmtLowerRef" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 전일 거래대금 미달
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="MoneyLowerRef" data-key2="VALUE1" data-type="MONEY" data-inputmask="'alias':'currency_normal'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="MoneyLowerRef" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 당일 거래랑 미달
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="AmtLowerCur" data-key2="VALUE1" data-type="MONEY" data-inputmask="'alias':'currency_normal'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="AmtLowerCur" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            한국주식 당일 거래대금 미달
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="text" class="form-control" placeholder="" data-key="MoneyLowerCur" data-key2="VALUE1" data-type="MONEY" data-inputmask="'alias':'currency_normal'" aria-required="true" aria-invalid="false" aria-describedby="name-error">
                                                                <div class="form-control-focus"> </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="MoneyLowerCur" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>

                                                    <tr>
                                                        <td>
                                                            거래정지 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit1" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            관리종목 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit2" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            우선주 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit3" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger"> </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            정리매매 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit4" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger"> </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            투자경고 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit5" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger">
                                                            </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            투자주의 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit6" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger"> </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            투자위험 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit7" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger"> </div>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            투자주의환기 조건 사용여부
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="col-md-12">
                                                                <input type="checkbox" class="make-switch" data-key="InvestLimit8" data-key2="ACTIVE" data-type="SWITCH" data-on-color="success" data-off-color="danger"> </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <div class="page-footer">
            <div class="page-footer-inner"> 2019 &copy; By Kyle.Moon
            </div>
            <div class="scroll-to-top">
                <i class="icon-arrow-up"></i>
            </div>
        </div>
        <!-- END FOOTER -->
    </div>

    <!--[if lt IE 9]>
<script src="../assets/global/plugins/respond.min.js"></script>
<script src="../assets/global/plugins/excanvas.min.js"></script> 
<script src="../assets/global/plugins/ie8.fix.min.js"></script> 
<![endif]-->
    <link rel="import" href="/templates/adm/commJs.html">

    <script type="text/javascript">
        $(document).ready(function() {

            Comm.init();

            getBizData();



            $("#formEdit").on('switchChange.bootstrapSwitch', function(event, state) {
                //这个state就是选择的状态
                if (state) {
                    editable();
                } else {
                    readonly();
                }
            });

            readonly();

            $("#saveBtn").on('click', function(event, state) {
                var datas = getAllData();
                saveData(datas);
            });

        });

        function saveData(datas) {

            var settings = {
                "async": false,
                "crossDomain": true,
                "url": Comm.getApiUrl() + "/api/Admin/UpMarketSettings",
                "method": "POST",
                "headers": Comm.getPostHeader(),
                "data": JSON.stringify(datas)
            }
            $.ajax(settings).done(function(response) {
                console.log(response);
                if (response.Result == 0) {
                    Comm.alert('데이터 변경 성공하였습니다.', 'success');
                } else {
                    Comm.alert(response.errorMsg, 'error');
                }
                getBizData();
                readonly();
                $("#formEdit").bootstrapSwitch("state", false);
            });
        }

        function getBizData() {
            var settings = {
                "async": false,
                "crossDomain": true,
                "url": Comm.getApiUrl() + "/api/Admin/GetMarketSettings?marketId=10",
                "method": "GET",
                "headers": Comm.getHeader()
            }

            $.ajax(settings).done(function(response) {
                console.log(response);
                if (response.Result == 0) {
                    var datas = response.Data;
                    setDataFromList(datas);
                }
            });
        }



        function editable() {
            $("input[type='text']").each(function(i, ipt) {
                $(ipt).attr("readonly", false);
            });
            $("select").each(function(i, ipt) {
                $(ipt).attr("disabled", false);
            });
            $(".make-switch").each(function() {
                if (this.id != "formEdit") {
                    $(this).bootstrapSwitch("readonly", false);
                }
            });
        }

        function readonly() {
            $("#settingForm").find("input").attr("readonly", true);

            $("select").each(function(i, ipt) {
                $(ipt).attr("disabled", true);
            });

            $("input[type='text']").each(function(i, ipt) {
                $(ipt).attr("readonly", true);
            });

            $(".make-switch").each(function() {
                if (this.id != "formEdit") {
                    $(this).bootstrapSwitch("readonly", true);
                }
            });
        }


        var getAllData = function() {
            var params = [];
            var domItems = $("[data-key]");
            domItems.each(function(index, item) {
                item = $(item);
                var itemNm = item.attr("data-key");
                var itemType = item.attr("data-type");
                var itemValue;
                switch (itemType) {
                    case "SWITCH":
                        itemValue = item.bootstrapSwitch("state");
                        if (itemValue) {
                            itemValue = 'Y';
                        } else {
                            itemValue = 'N';
                        }
                        break;
                    case "TEXT":
                        itemValue = item.val();
                        if (itemValue == null) {
                            itemValue = "";
                        }
                        break;
                    case "MONEY":
                        itemValue = Inputmask.unmask(item.val(), {
                            alias: "currency"
                        });
                        if (itemValue == null) {
                            itemValue = 0;
                        }
                        break;
                    case "SELECT":
                        itemValue = item.val();
                        break;
                    case "INTEGER":
                        itemValue = item.val();
                        if (itemValue == null || itemValue == "") {
                            itemValue = 0;
                        }
                        break;
                    case "PERCENT":
                        itemValue = Inputmask.unmask(item.val(), {
                            alias: "leftPercent"
                        });
                        // console.log("percent=" + itemValue);
                        if (itemValue == null) {
                            itemValue = 0;
                        }
                        break;
                }
                if (itemNm == 'BankProcessTimeS') {
                    BankProcessTime.OPTKEY = 'BankProcessTime';
                    BankProcessTime.OPTMAINVALUE = itemValue;
                    BankProcessTime.ACTIVE = 'Y';
                } else if (itemNm == 'BankProcessTimeE') {
                    BankProcessTime.OPTKEY = 'BankProcessTime';
                    BankProcessTime.OPTSUBVALUE1 = itemValue;
                    BankProcessTime.ACTIVE = 'Y';
                } else {
                    var param = {};
                    param.OPTKEY = itemNm;
                    param.OPTMAINVALUE = itemValue;
                    param.ACTIVE = 'Y';
                    params.push(param);
                }
            });
            params.push(BankProcessTime);
            return params;

        }

        var setDataFromList = function(datas) {

            var domItems = $('#settingForm').find("[data-key]");
            domItems.each(function(index, item) {
                item = $(item);
                var itemNm = item.attr("data-key");
                var itemCl = item.attr("data-key2");
                var itemType = item.attr("data-type");
                var setInfo = getSetInfoFromList(datas, itemNm);
                if (itemCl == 'VALUE1') {
                    let value = setInfo.VALUE1;
                    if (itemType == 'MONEY') {
                        value = Inputmask.format(value, {
                            alias: "currency_normal"
                        });
                        item.val(value);
                    } else if (itemType == 'INTEGER') {
                        item.val(value);
                    } else if (itemType == 'PERCENT') {
                        value = Inputmask.format(value, {
                            alias: "leftPercent"
                        });
                        item.val(value);
                    }
                } else if (itemCl == 'ACTIVE') {
                    let value = setInfo.ACTIVE;
                    if (value == "Y") {
                        item.bootstrapSwitch("state", true);
                    }
                    if (value == "N") {
                        item.bootstrapSwitch("state", false);
                    }
                }
            });
        }

        var getSetInfoFromList = function(datas, key) {
            let temp = {};
            $.each(datas, function(index, data) {
                if (key == data.CONFIGNAME) {
                    temp = data;
                }
            })
            return temp;
        }
    </script>
</body>

</html>