<!DOCTYPE html>
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="import" href="/templates/adm/commCss.html">
    <title>SHRUB</title>
    <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
    <div class="page-wrapper">
        <!-- BEGIN HEADER -->
        <div class="page-header navbar navbar-fixed-top">
            <!-- BEGIN HEADER INNER -->
            <div class="page-header-inner ">
                <!-- BEGIN LOGO -->
                <div class="page-logo">
                    <a href="/templates/adm/index.html">
                        <img src="" alt="logo" class="logo-default" /> </a>
                    <div class="menu-toggler sidebar-toggler">
                        <span></span>
                    </div>
                </div>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
                    <span></span>
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <div class="top-menu">
                    <ul class="nav navbar-nav pull-right">
                        <!-- END USER LOGIN DROPDOWN -->
                        <!-- BEGIN QUICK SIDEBAR TOGGLER -->
                        <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                        <li>
                            <p style="color: white">Welcome Loginer</p>
                        </li>
                        <li class="dropdown dropdown-quick-sidebar-toggler">
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-logout"></i>
                            </a>
                        </li>
                        <!-- END QUICK SIDEBAR TOGGLER -->
                    </ul>
                </div>
                <!-- END TOP NAVIGATION MENU -->
            </div>
            <!-- END HEADER INNER -->
        </div>
        <!-- END HEADER -->
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN SIDEBAR -->
            <div class="page-sidebar-wrapper">
                <div class="page-sidebar navbar-collapse collapse">
                    <ul id="ul_menu" class="page-sidebar-menu  page-header-fixed " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200" style="padding-top: 20px">


                    </ul>
                </div>
            </div>
            <!-- END SIDEBAR -->

            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE TITLE-->
                    <h1 class="page-title"> Market 휴일관리
                        <!-- <small>...</small> -->
                    </h1>
                    <!-- END PAGE TITLE-->
                    <!-- END PAGE HEADER-->
                    <!-- BEGIN DASHBOARD STATS 1-->
                    <div class="clearfix"></div>
                    <!-- END DASHBOARD STATS 1-->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="portlet light portlet-fit bordered">

                                <div class="portlet-title" style="background-color: #E9EDEF">
                                    <form action="#" class="form-horizontal" id="form_sample_1" novalidate="novalidate">
                                        <div class="form-body">

                                            <div class="form-group  " style="margin-bottom:0px">

                                                <label class="col-md-1 control-label" for="form_control_1">
                                                    <span class="required" aria-required="true"></span>Market</label>
                                                <div class="col-md-1">
                                                    <select class="form-control" id="marketId">
                                                        <option value="10">한국주식</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-10">
                                                    <div style="float: right;margin-right: 10px;">
                                                        <button type="button" id="searchBtn" class="btn green-haze btn-outline sbold uppercase dark">조회</button>
                                                        <button type="button" id="openModalBtn" class="btn green-haze btn-outline sbold uppercase dark">추가</button>
                                                        <!-- <button type="button" id="removeBtn" class="btn green-haze btn-outline sbold uppercase dark">삭제</button> -->
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <div>&nbsp;</div>
                                </div>
                                <div class="portlet-body">

                                    <table id="table_client" class=""></table>
                                    <div id="modal_item" class="modal fade" tabindex="-1" data-width="700" data-backdrop="static" data-keyboard="false">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                            <h3 class="modal-title">휴일 추가</h3>
                                        </div>
                                        <div class="modal-body" style="padding-top: 0;">
                                            <div class="portlet box ">
                                                <div class="portlet-body form">
                                                    <form id="editForm" action="#" class="form-horizontal form-bordered form-row-stripped">
                                                        <div class="form-body">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-3">MarketId</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" value="" readonly data-key="MARKETID" data-type="TEXT" />
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">휴일</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" id="holiday" value="" data-key="HOLIDAY" data-type="TEXT" maxlength="10" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">메모</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" value="" data-key="MEMO" data-type="TEXT" maxlength="30" />
                                                                </div>
                                                            </div>


                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" data-dismiss="modal" class="btn btn-outline dark">취소</button>
                                            <button type="button" id="addBtn" class="btn green">추가</button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <div class="page-footer">
            <div class="page-footer-inner"> 2019 &copy; By Kyle.Moon
            </div>
            <div class="scroll-to-top">
                <i class="icon-arrow-up"></i>
            </div>
        </div>
        <!-- END FOOTER -->
    </div>




    <link rel="import" href="/templates/adm/commJs.html">
    <script type="text/javascript">
    </script>
</body>
<script type="text/javascript">
    $(document).ready(function() {

        Comm.init();
        $('#holiday').inputmask("yyyy-mm-dd");
        make_table();
        $("#searchBtn").on('click', function() {
            $("#table_client").bootstrapTable('refresh');
        });

        $("#addBtn").on('click', function() {
            addItem();
        });

        $("#openModalBtn").on('click', function() {
            openModal();
        });

        $("#removeBtn").on('click', function() {
            removeItem();
        });



    });

    var cleanModal = function() {
        Comm.cleanDomData($("#modal_item"));
    }

    var showModal = function() {
        $("#modal_item").modal("show");
    }

    var openModal = function(ITEMID) {
        cleanModal();
        Comm.getElementByDataKey('MARKETID').val($("#marketId").val());
        showModal();
    }

    var addItem = function() {


        var data = Comm.getDomData($('#editForm'));

        var settings = {
            "async": false,
            "crossDomain": true,
            "url": Comm.getApiUrl() + "/api/Admin/AddMarketHoliday",
            "method": "POST",
            "headers": Comm.getPostHeader(),
            "data": JSON.stringify(data)
        }

        $.ajax(settings).done(function(response) {
            console.log(response);
            if (response.Result == 0) {
                $("#modal_item").modal("hide");
                Comm.alert('추가 성공하였습니다.', 'success');
            } else {
                Comm.alert(response.ErrorMsg, 'error');
            }

            $("#table_client").bootstrapTable('refresh');
        });

    }

    var removeItem = function(item) {
        // Comm.confirm(
        //     '삭제하시겠습니까?', 'warning',
        //     function() {

        //         var settings = {
        //             "async": false,
        //             "crossDomain": true,
        //             "url": Comm.getApiUrl() + "/api/Admin/RemoveMarketHoliday",
        //             "method": "POST",
        //             "headers": Comm.getPostHeader(),
        //             "data": JSON.stringify(item)
        //         }

        //         $.ajax(settings).done(function(response) {
        //             console.log(response);
        //             if (response.Result == 0) {
        //                 Comm.alert('삭제 성공하였습니다.', 'success');
        //             } else {
        //                 Comm.alert(response.ErrorMsg, 'error');
        //             }

        //             $("#table_client").bootstrapTable('refresh');
        //         });
        //     }
        // );

        swal({
                title: "Alert",
                text: '삭제하시겠습니까?',
                type: 'warning',
                showConfirmButton: "btn-success",
                allowOutsideClick: true,
                showCancelButton: true,
                confirmButtonText: "확인",
                cancelButtonText: "취소",
                closeOnConfirm: true,
                closeOnCancel: true
            },
            function(isConfirm) {
                if (isConfirm) {

                    var settings = {
                        "async": false,
                        "crossDomain": true,
                        "url": Comm.getApiUrl() + "/api/Admin/RemoveMarketHoliday",
                        "method": "POST",
                        "headers": Comm.getPostHeader(),
                        "data": JSON.stringify(item)
                    }

                    $.ajax(settings).done(function(response) {
                        console.log(response);
                        if (response.Result == 0) {
                            // Comm.alert('삭제 성공하였습니다.', 'success');
                            swal('Alert', '삭제 성공하였습니다.', 'success');
                        } else {
                            swal('Alert', response.ErrorMsg, 'error');
                        }

                        $("#table_client").bootstrapTable('refresh');
                    });
                } else {

                }

            }
        );




    }




    var make_table = function() {
        var header = Comm.getHeader();
        header.crossDomain = true;
        $("#table_client").bootstrapTable({
            url: Comm.getApiUrl() + '/api/Admin/GetMarketHoliday', // 请求后台的URL（*）
            method: 'get', // 请求方式（*）
            dataType: 'json',
            // toolbar : '#toolbar', // 工具按钮用哪个容器
            striped: true, // 是否显示行间隔色
            cache: false, // 是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, // 是否显示分页（*）
            sortable: false, // 是否启用排序
            sortOrder: "asc", // 排序方式
            sidePagination: "client", // 分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, // 初始化加载第一页，默认第一页
            pageSize: 10, // 每页的记录行数（*）
            pageList: [10, 25, 50, 100], // 可供选择的每页的行数（*）
            search: false, // 是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            // contentType : "application/x-www-form-urlencoded",
            contentType: "application/json",
            strictSearch: false,
            showColumns: false, // 是否显示所有的列
            showRefresh: false, // 是否显示刷新按钮
            minimumCountColumns: 2, // 最少允许的列数
            clickToSelect: false, // 是否启用点击选中行
            // height : 300, // 行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            // uniqueId: "no", // 每一行的唯一标识，一般为主键列
            showToggle: false, // 是否显示详细视图和列表视图的切换按钮
            cardView: false, // 是否显示详细视图
            detailView: false, // 是否显示父子表
            ajaxOptions: {
                headers: header
            },
            queryParams: function(params) {
                return {
                    marketId: $("#marketId").val(),
                }
            },
            columns: [
                //     {
                //     field: 'selectItem',
                //     checkbox: true,
                // }, 
                {
                    // field: 'no',
                    title: '순번',
                    sortable: true,
                    align: "center",
                    formatter: function(value, row, index) {

                        return index + 1;
                    }
                },

                {
                    field: 'MARKETID',
                    title: 'MARKETID',
                    align: "center"
                }, {
                    field: 'HOLIDAY',
                    title: 'HOLIDAY',
                    align: "center"
                }, {
                    field: 'MEMO',
                    title: 'MEMO',
                    align: "center"
                }, {
                    title: 'ACTION',
                    align: "center",
                    formatter: function(value, row, index) {
                        var actionHtml = "";
                        actionHtml = '<a class="green-color green-haze btn-outline removeA" href="#" ';
                        actionHtml += '>삭제</a>';
                        // actionHtml = '<button class="green-color green-haze btn-outline removeA">삭제</button>'
                        return actionHtml;
                    },
                    events: operateEvents
                }
            ],

            responseHandler: function(res) {
                console.log(res);
                return res.Data;
            },
            onLoadSuccess: function() { // 加载成功时执行
                console.log("加载成功");
            },
            onLoadError: function() { // 加载失败时执行
                console.log("加载数据失败");
            }
        });


    };

    window.operateEvents = {
        'click .removeA': function(e, value, row, index) {
            removeItem(row);
        },
    };
</script>

</html>