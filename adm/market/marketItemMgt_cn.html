<!DOCTYPE html>
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="import" href="/templates/adm/commCss.html">
    <title>SHRUB</title>
    <link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->

<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
    <div class="page-wrapper">
        <!-- BEGIN HEADER -->
        <div class="page-header navbar navbar-fixed-top">
            <!-- BEGIN HEADER INNER -->
            <div class="page-header-inner ">
                <!-- BEGIN LOGO -->
                <div class="page-logo">
                    <a href="/templates/adm/index.html">
                        <img src="" alt="logo" class="logo-default" /> </a>
                    <div class="menu-toggler sidebar-toggler">
                        <span></span>
                    </div>
                </div>
                <!-- END LOGO -->
                <!-- BEGIN RESPONSIVE MENU TOGGLER -->
                <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse">
                    <span></span>
                </a>
                <!-- END RESPONSIVE MENU TOGGLER -->
                <!-- BEGIN TOP NAVIGATION MENU -->
                <div class="top-menu">
                    <ul class="nav navbar-nav pull-right">
                        <!-- END USER LOGIN DROPDOWN -->
                        <!-- BEGIN QUICK SIDEBAR TOGGLER -->
                        <!-- DOC: Apply "dropdown-dark" class after below "dropdown-extended" to change the dropdown styte -->
                        <li>
                            <p style="color: white">Welcome Loginer</p>
                        </li>
                        <li class="dropdown dropdown-quick-sidebar-toggler">
                            <a href="javascript:;" class="dropdown-toggle">
                                <i class="icon-logout"></i>
                            </a>
                        </li>
                        <!-- END QUICK SIDEBAR TOGGLER -->
                    </ul>
                </div>
                <!-- END TOP NAVIGATION MENU -->
            </div>
            <!-- END HEADER INNER -->
        </div>
        <!-- END HEADER -->
        <!-- BEGIN HEADER & CONTENT DIVIDER -->
        <div class="clearfix"> </div>
        <!-- END HEADER & CONTENT DIVIDER -->
        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN SIDEBAR -->
            <div class="page-sidebar-wrapper">
                <div class="page-sidebar navbar-collapse collapse">
                    <ul id="ul_menu" class="page-sidebar-menu  page-header-fixed " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200" style="padding-top: 20px">


                    </ul>
                </div>
            </div>
            <!-- END SIDEBAR -->

            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <!-- BEGIN CONTENT BODY -->
                <div class="page-content">
                    <!-- BEGIN PAGE HEADER-->
                    <!-- BEGIN PAGE TITLE-->
                    <h1 class="page-title"> 주식아이템관리
                        <!-- <small>...</small> -->
                    </h1>
                    <!-- END PAGE TITLE-->
                    <!-- END PAGE HEADER-->
                    <!-- BEGIN DASHBOARD STATS 1-->
                    <div class="clearfix"></div>
                    <!-- END DASHBOARD STATS 1-->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="portlet light portlet-fit bordered">

                                <div class="portlet-title" style="background-color: #E9EDEF">
                                    <form action="#" class="form-horizontal" id="form_sample_1" novalidate="novalidate">
                                        <div class="form-body">

                                            <div class="form-group  " style="margin-bottom:0px">
                                                <label class="col-md-1 control-label" for="form_control_1">
                                                    <span class="required" aria-required="true"></span>아이디</label>
                                                <div class="col-md-1">
                                                    <input id='Key' name="Key" class="form-control" />
                                                </div>

                                                <label class="col-md-1 control-label" for="form_control_1">
                                                    <span class="required" aria-required="true"></span>거래가능여부</label>
                                                <div class="col-md-1">
                                                    <select class="form-control" id="Tradable">
                                                        <option value="">전부</option>
                                                        <option value="Y">Y</option>
                                                        <option value="N">N</option>
                                                    </select>
                                                </div>
                                                <label class="col-md-1 control-label" for="form_control_1">
                                                    <span class="required" aria-required="true"></span>공매매여부</label>
                                                <div class="col-md-1">
                                                    <select class="form-control" id="ShortSellAllow">
                                                        <option value="">전부</option>
                                                        <option value="Y">Y</option>
                                                        <option value="N">N</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <div style="float: right;margin-right: 10px;">
                                                        <button type="button" id="searchBtn" class="btn green-haze btn-outline sbold uppercase dark">조회</button>
                                                        <!-- <button type="button" id="activeBtn" class="btn green-haze btn-outline sbold uppercase dark">활성화</button> -->
                                                        <!-- <a class="btn green-haze btn-outline sbold uppercase dark" data-target="#modal_user" data-toggle="modal">ㅋㅋㅋ</a> -->
                                                        <!--<a class="btn green-haze btn-outline sbold uppercase dark" data-target="#modal_encashment" data-toggle="modal">원금출금신청</a>
                                                        <a class="btn green-haze btn-outline sbold uppercase dark" data-target="#modal_encashment2" data-toggle="modal">담보금출금신청</a> -->
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </form>
                                    <div>&nbsp;</div>
                                </div>
                                <div class="portlet-body">

                                    <table id="table_client" class=""></table>
                                    <div id="modal_item" class="modal fade" tabindex="-1" data-width="700" data-backdrop="static" data-keyboard="false">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                            <h3 class="modal-title">주식아이템 정보 변경</h3>
                                        </div>
                                        <div class="modal-body" style="padding-top: 0;">
                                            <div class="portlet box ">
                                                <div class="portlet-body form">
                                                    <form id="editForm" action="#" class="form-horizontal form-bordered form-row-stripped">
                                                        <div class="form-body">
                                                            <div class="form-group">
                                                                <label class="control-label col-md-3">아이디</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" value="" readonly data-key="ItemId" data-type="TEXT" />
                                                                    <input type="hidden" class="form-control" value="" readonly data-key="MarketId" data-type="TEXT" />
                                                                </div>
                                                            </div>

                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">항목한글명</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" value="" data-key="ItemKo" data-type="TEXT" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">항목영문명</label>
                                                                <div class="col-md-9">
                                                                    <input type="text" class="form-control" value="" data-key="ItemEn" data-type="TEXT" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">거래가능여부</label>
                                                                <div class="col-md-9">
                                                                    <select class="form-control" data-key="Tradable" data-type="SELECT">
                                                                        <option value="Y">가능</option>
                                                                        <option value="N">불가능</option>
                                                                        
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-md-3 control-label">공매매가능여부</label>
                                                                <div class="col-md-9">
                                                                    <select class="form-control" data-key="ShortSellAllow" data-type="SELECT">
                                                                        <option value="Y">가능</option>
                                                                        <option value="N">불가능</option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" data-dismiss="modal" class="btn btn-outline dark">취소</button>
                                            <button type="button" id="saveBtn" class="btn green">변경</button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->
        <!-- BEGIN FOOTER -->
        <div class="page-footer">
            <div class="page-footer-inner"> 2019 &copy; By Kyle.Moon
            </div>
            <div class="scroll-to-top">
                <i class="icon-arrow-up"></i>
            </div>
        </div>
        <!-- END FOOTER -->
    </div>




    <link rel="import" href="/templates/adm/commJs.html">
    <script src="/templates/adm/user/userMgt.js" type="text/javascript"></script>
    <script type="text/javascript">
    </script>
</body>
<script type="text/javascript">
    $(document).ready(function() {

        Comm.init();
        make_table();
        $("#searchBtn").on('click', function() {
            $("#table_client").bootstrapTable('refresh');
        });

        $("#saveBtn").on('click', function() {
            modifyItem();
        });

    });

    var cleanModal = function() {
        Comm.cleanDomData($("#modal_item"));
    }

    var showModal = function() {
        $("#modal_item").modal("show");
    }

    var editModal = function(ITEMID) {
        cleanModal();
        var rows = $('#table_client').bootstrapTable('getRowByUniqueId', ITEMID); //行的数据

        var ItemId = Comm.getElementByDataKey('ItemId');
        var MarketId = Comm.getElementByDataKey('MarketId');
        var ItemKo = Comm.getElementByDataKey('ItemKo');
        var ItemEn = Comm.getElementByDataKey('ItemEn');
        var Tradable = Comm.getElementByDataKey('Tradable');
        var ShortSellAllow = Comm.getElementByDataKey('ShortSellAllow');
        ItemId.val(rows.ITEMID);
        MarketId.val(rows.MARKETID);
        ItemKo.val(rows.ITEMKO);
        ItemEn.val(rows.ITEMEN);
        Tradable.val(rows.TRADABLE);
        ShortSellAllow.val(rows.SHORTSELLALLOW);
        showModal();
    }

    var modifyItem = function() {


        var data = Comm.getDomData($('#editForm'));
        var settings = {
            "async": false,
            "crossDomain": true,
            "url": Comm.getApiUrl() + "/api/Admin/UpTradeItem",
            "method": "POST",
            "headers": Comm.getPostHeader(),
            "data": JSON.stringify([data])
        }

        $.ajax(settings).done(function(response) {
            console.log(response);
            if (response.Result == 0) {
                $("#modal_item").modal("hide");
                Comm.alert('변경 완료 되었습니다.', 'success');
            } else {
                Comm.alert(response.ErrorMsg, 'error');
            }

            $("#table_client").bootstrapTable('refresh');
        });

    }




    var make_table = function() {
        var header = Comm.getPostHeader();
        header.crossDomain = true;
        $("#table_client").bootstrapTable({
            url: Comm.getApiUrl() + '/api/Admin/GetTradeItem', // 请求后台的URL（*）
            method: 'post', // 请求方式（*）
            dataType: 'json',
            // toolbar : '#toolbar', // 工具按钮用哪个容器
            striped: true, // 是否显示行间隔色
            cache: false, // 是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true, // 是否显示分页（*）
            sortable: false, // 是否启用排序
            sortOrder: "asc", // 排序方式
            sidePagination: "client", // 分页方式：client客户端分页，server服务端分页（*）
            pageNumber: 1, // 初始化加载第一页，默认第一页
            pageSize: 10, // 每页的记录行数（*）
            pageList: [10, 25, 50, 100], // 可供选择的每页的行数（*）
            search: false, // 是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
            // contentType : "application/x-www-form-urlencoded",
            contentType: "application/json",
            strictSearch: false,
            showColumns: false, // 是否显示所有的列
            showRefresh: false, // 是否显示刷新按钮
            minimumCountColumns: 2, // 最少允许的列数
            clickToSelect: false, // 是否启用点击选中行
            // height : 300, // 行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            uniqueId: "ITEMID", // 每一行的唯一标识，一般为主键列
            showToggle: false, // 是否显示详细视图和列表视图的切换按钮
            cardView: false, // 是否显示详细视图
            detailView: false, // 是否显示父子表
            ajaxOptions: {
                headers: header
            },
            queryParams: function(params) {
                return {
                    MarketId: '10',
                    Key: $('#Key').val(),
                    Tradable: $('#Tradable').val(),
                    ShortSellAllow: $('#ShortSellAllow').val(),
                }
            },
            columns: [
                // {
                //     checkbox: true,
                //     formatter: function(value, row, index) {
                //         if (row.ACTIVE == 'Y')
                //             return {
                //                 disabled: true //设置选中
                //             };
                //         return value;
                //     }
                // }, 
                {
                    field: 'ITEMID',
                    title: 'ITEMID',
                    align: "center"
                }, {
                    field: 'MARKETID',
                    title: 'MARKETID',
                    align: "center"
                }, {
                    field: 'ITEMKO',
                    title: 'ITEMKO',
                    align: "center"
                }, {
                    field: 'ITEMEN',
                    title: 'ITEMEN',
                    align: "center"
                }, {
                    field: 'SYMBOL',
                    title: 'SYMBOL',
                    align: "center"
                }, {
                    field: 'TRADABLE',
                    title: 'TRADABLE',
                    align: "center"
                }, {
                    field: 'SHORTSELLALLOW',
                    title: 'SHORTSELLALLOW',
                    align: "center"
                }, {
                    field: 'SUBMKT',
                    title: 'SUBMKT',
                    align: "center"
                },
                // {
                //     title: '오픈시간',
                //     align: "center",
                //     formatter: function(value, row, index) {
                //         let returnTime = '';
                //         let tradingTimes = row.MARKET.TRADINGTIMEINFOs;
                //         if (tradingTimes != null) {
                //             $.each(tradingTimes, function(index, item) {
                //                 if (item.MGMTTYPE == '0001') {
                //                     returnTime = item.LOCALOPENTIME + ' ~ ' + item.LOCALCLOSETIME
                //                 }
                //             })
                //         }
                //         return returnTime;
                //     }
                // }, {
                //     title: '휴식시간',
                //     align: "center",
                //     formatter: function(value, row, index) {
                //         let returnTime = '';
                //         let tradingTimes = row.MARKET.TRADINGTIMEINFOs;
                //         if (tradingTimes != null) {
                //             $.each(tradingTimes, function(index, item) {
                //                 if (item.MGMTTYPE == '0002') {
                //                     returnTime = item.LOCALOPENTIME + ' ~ ' + item.LOCALCLOSETIME
                //                 }
                //             })
                //         }
                //         return returnTime;
                //     }
                // }, 
                {
                    title: 'Action',
                    align: "center",
                    formatter: function(value, row, index) {

                        var actionHtml = "";

                        actionHtml += '<a class="green-color green-haze btn-outline" href="#"  onclick="editModal(\'';
                        actionHtml += row.ITEMID;
                        actionHtml += '\')">EDIT</a> ';
                        return actionHtml;
                    }
                }

            ],

            responseHandler: function(res) {
                console.log(res);
                return res.Data;
            },
            onLoadSuccess: function() { // 加载成功时执行
                console.log("加载成功");
            },
            onLoadError: function() { // 加载失败时执行
                console.log("加载数据失败");
            }
        });
    };
</script>

</html>